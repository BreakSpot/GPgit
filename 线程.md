## 线程

线程指在程序执行过程中，能够执行程序代码的一个执行单位，每个程序至少都有一个线程，也就是程序本身，java中的线程有四种状态：就绪、运行、挂起、结束。

### 线程和进程的区别（面试问）

- 进程是资源分配的最小单位，线程是程序执行的最小单位
- 进程有自己的独立地址空间，每启动一个进程，系统就会为它分配地址空间，建立数据表来维护代码段、堆栈段和数据段、这种操作非常昂贵。而线程是共享进程中的数据的，使用相同的地址空间，因此CPU切换一个线程的花费远比进程要小很多，同时创建一个线程的开销也比进程要小很多。
- 线程之间的通信更方便，同一进程下的线程共享全局变量、静态变量等数据，而进程之间的通信需要以通信的方式进行，不过如何处理好同步与互斥是多线程程序的难点
- 多进程程序更健壮，多线程程序只要有一个线程死掉，整个进程也死掉，而一个进程死掉并不会对另外一个进程造成影响，因为进程有自己独立的地址空间

### 进程间通信和线程间通信（面试问）

1、进程

管道：管道是一种半双工的通信方式，数据只能单向流动，而且只能在具有亲缘关系的进程间使用，进程的亲缘关系通常是指父子进程关系。

有名管道：也是半双工的通信方式，运行无亲缘关系进程间的通信。

信号量：信号量是一个计数器，可以用来控制多个进程对共享资源的访问，它常作为一种锁机制，防止某进程正在访问共享资源时，其他进程也访问该资源，因此，主要作为进程间以及同一进程内不同线程之间的同步手段。

消息队列：消息队列是由消息的链表，存放在内核中并由消息队列标识符标识，消息队列客服了信号传递信息少的缺点

2、线程

锁机制：包括互斥锁、条件变量、读写锁

线程间的通信目的主要是用于线程同步

### 应用场景

- 需要频繁创建销毁的优先用线程
- 需要进行大量计算的优先使用线程
- 强相关的处理用线程，弱相关的处理用进程
- 可能扩展到多机分布的用进程，多核分布的用线程

### 线程池

线程池用于**限制应用程序中同一时刻运行的线程数**，因为每启动一个新的线程都会有相应的性能开销，每个线程都需要给栈分配一些内存，创建/销毁线程伴随着系统开销，过于频繁的创建/销毁线程，会很大程度上影响处理效率，如果线程并发数量过多，抢占系统资源从而导致阻塞。

在java中由java.util.concurrent.Executor提供

基本组件：

- 线程池管理器：用于创建并管理线程，包括创建线程池，销毁线程池，添加新任务
- 工作线程：线程池中线程，在没有任务时处于等待状态，可以循环的执行任务
- 任务接口：每个任务必须实现的接口，以供工作线程调度任务的执行，他主要规定了人物的入口任务执行完的收尾工作，任务的执行状态
- 任务队列：用于存放没有处理的任务，提供一种缓冲机制

常见线程：

- 单个线程的线程池，线程池中每次只有一个线程工作，单线程串行执行任务
- 固定数量的线程池，每提交一个任务就是一个线程，直到达线程池的最大数量，然后后面进入等待队列直到前面的任务完成才继续执行
- 可缓存线程池，当线程池大小超过了处理任务所需的线程，那么就会回收部分空闲的线程，当有任务来世，又智能的添加新线程来执行
- 大小无限制的线程池，支持定时和周期性的执行线程

为什么要用：

- 1、减少了创建和撤销线程的次数，每个工作线程都可以被重复利用，可以执行多个任务
- 2、根据系统的承受能力，调整线程池中工作线程的数目，防止因为消耗过多的内存，而把服务器累趴下。













